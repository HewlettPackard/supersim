# Supersim - Easy Simulations with sssweep

In this tutorial we introduce sssweep, a python package that provides a flexible and easy-to-use system to design, run, parse and plot SuperSim simulations with any number of variables and network configurations. Sssweep auto-creates a web-viewer to help view and analyse your results, the web-viewer is tailored to the specific parameters of your simulation.
In sssweep each simulation variable is independent, the tool automatically generates the permutation of these variables to create the different simulation configurations.

To demonstrate the simplicity of running simulations in sssweep, in this tutorial we perform the **same** simulation study as in [Automated Simulations](auto_sims.md) except we generate many more analysis plots.
To get the details of the study please review the [Automated Simulation tutorial](auto_sims.md).

## Setup
Let's create a directory to hold this investigation.

``` sh
mkdir -p ~/sims/easy_sims
cd ~/sims/easy_sims

```

Now fetch the sssweep script that we'll use for automated simulations.

``` sh
cp ~/ssdev/supersim/scripts/easy_sims.py .
```

Now let's compare the two scripts for automated simulations to see how sssweep simplifies simulation configuration.

``` sh
emacs easy_sims.py ~/ssdev/supersim/scripts/auto_sims.py
```
Both scripts start by setting and building taskrun and resources followed by the definition of some simulation settings, such a load settings in the case of [auto_sims.py][] and simulation paths for [easy_sims.py][].
At this point the two scripts diverge, [auto_sims.py][] creates the simulation, parsing and plotting tasks by looping *multiple* times through the simulation variables load and routing algorithms.
However, sssweep [easy_sims.py][] only requires to create the Sweeper object, define the simulation variables and add the loads variable.

Simulation variables are defined in 3 steps:
1. Set the variable options, e.g. `routing_algorithms = ['oblivious','adaptive']`.
   * Simulation variables can be defined in a dictionary format or a list of strings.
2. Specify a function with the list of commands required to set the variable in the JSON settings file.
   * The set commands can be provided in a single string format or an array of strings.
3. Add the variable (`add_variable`) to the sweeper object.

The load variable does not need variable options, instead you only define the load command function and add the loads (`add_loads`) to the sweeper object.

Now the simulation is ready to be run by auto-adding and running the tasks.
This shows the easiness of sssweep to setup simulations, all the code done in [auto_sims.py][] is auto-generated by sssweep for you.
This makes running large simulations with a large number of variables easy to perform.

To see a detailed explanation of sssweep, you can see a tutorial in the docs folder in the [sssweep][] package.

## Run
We'll use an example settings file from the SuperSim project.

``` sh
cp ~/ssdev/supersim/json/fattree_iq_blast.json settings.json
```

Now we are ready to run the sssweep script.

``` sh
./easy_sims.py output \
  ~/ssdev/supersim/bazel-bin/supersim \
  ~/ssdev/ssparse/bazel-bin/ssparse \
  ~/ssdev/ssparse/scripts/transient.py \
  settings.json -g 3
```

## Web plot viewer

A key feature of sssweep is the ability to easily see and analyse your results on a web-browser.
To look at the resulting plots, let's run a local Python server.

``` sh
cd output/
python3 -m http.server 8888
```

Now you can open a web browser to view the results.
If you are running the web browser in the same computer as the simulations, then type the following address:

```
http://localhost:8888/web_viewer/plots.html
```

If you are sharing your results to be viewed on another computer, replace `localhost` with the IP of the computer where the simulations reside.
In the web-viewer select the desired options from the drop-downs to view your plot.
Note, we have three different plotting options: load vs. latency plot (lplot), load distribution plots with single injection rate (qplot) and comparison plots (cplot).

Now you are ready to run large or complex simulations with just a few lines of code. Enjoy!

[TaskRun]: https://github.com/nicmcd/taskrun
[SSparse]: https://github.com/nicmcd/ssparse
[SSPlot]: https://github.com/nicmcd/ssplot
[sssweep]: https://github.com/nicmcd/sssweep
[easy_sims.py]: ../scripts/easy_sims.py
[auto_sims.py]: ../scripts/auto_sims.py
